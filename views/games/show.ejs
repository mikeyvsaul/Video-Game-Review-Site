<%- include('../partials/header') %>

<div id="show-view">
  <div id="show-container" class="container is-fluid">
    <div class="columns">
      <div class="column">
        <img id="details-art" src="<%= game.boxArt %>" alt="Game Box Art">
      </div>
      <div id="game-details" class="column is-two-thirds">
        <div class="content">
          <h2>Title: <%= game.name %> </h2>
          <h4>Release Year: <%= game.releaseYear %></h4>
        </div>
      </div>
    </div>
  </div>
  
  <br><br><div id="reviews-container" class="container is-fluid">
    <% if (user && (reviews.filter(review => review.gamer.equals(user._id)).length < 1)) { %>
      <form action="/games/<%= game._id %>/reviews/new">
        <button class="button is-info" type="submit">Add New Review</button>
      </form>
    <% } %>
  
    <% if (game.reviews.length) { %>
      <table id="reviews-table" class="table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Review</th>
          </tr>
        </thead>
        <tbody>
          <% game.reviews.forEach(function(r) { %>  
            <tr>
              <td><%= r.createdAt.toLocaleDateString() %></td>
              <td><textarea class="textarea" rows="10" cols="90" readonly><%= r.review %></textarea></td>
              <div class="user-review">
                <% if (user && r.gamer.equals(user._id)) { %>
                  <td><a class="button is-warning" href="/reviews/<%=r._id%>/edit">Edit</a></td>
                  <td>
                    
                  </td>
                <% } %> 
              </div>
            </tr>
          <% }); %>
        </tbody>
      </table>
    <% } else { %>
      <h5>No Reviews Yet</h5>
    <% } %>
  </div>
</div>

<%- include('../partials/footer') %>